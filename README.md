![OneScriptDB](https://github.com/vasvl123/OneScriptDB/blob/master/resource/osdb.png "OneScriptDB")
## OneScriptDB - инструмент концептуального проектирования
### Открытый, некоммерческий, исследовательский проект в области компьютерной лингвистики

[![Join the chat at https://gitter.im/OneScriptDB/Lobby](https://badges.gitter.im/OneScriptDB/Lobby.svg)](https://gitter.im/OneScriptDB/Lobby?utm_source=badge&utm_medium=badge&utm_campaign=pr-badge&utm_content=badge)

## Цель и задачи проекта

Цель проекта - разработка инструмента проектирования и моделирования поведения сложных систем, представленных в виде семантической сети - отношений понятий реального мира.
В процессе реализации проекта будет разработана концепция и действующая модель [распределенного сообщества](https://github.com/vasvl123/distributed-community).
Полученные результаты безвозмездно передаются в общественное пользование.

## Работа с проектом

Программный код OneScriptDB исполняется независимым кросплатформенным интерпретатором языка 1С - [OneScript](https://github.com/EvilBeaver/OneScript).

Адрес тестового сервера: http://vasvl123.github.io/OneScriptDB Имя/пароль - admin/admin

Для локального запуска на своем компьютере необходимо:
Скачать этот репозиторий к себе на диск.
Скачать и установить последнюю версию OneScript http://oscript.io/downloads
Установить библиотеку .Net версии не ниже 4.5 - для Windows, а для linux mono-complete не ниже 5.2.
Перейти в папку OneScriptDB и выполнить команду: oscript starter.os
Открыть в браузере адрес: http://localhost:8888

## Этапы реализации проекта

### На текущий момент реализованы:

1. Модуль запуска приложения и управления процессами (starter.os).
2. Модуль веб-сервера (webserver.os).
3. Модуль контроллера простых статичных страниц (webdata.os).
4. Модуль контроллера одностраничного интерфейса пользователя (showdata.os)
5. Модуль интерпретации и отображения DOM-структуры данных (pagedata.os).
6. Модуль сервера данных (dataserver.os).
7. Модуль работы с файлами контейнерами данных (dbaccess.os)
8. Библиотеки подключаемых функций, операторов (/lib/Операторы.os, /lib/Системные.os).
9. Шаблоны интерфейса(howdata.html, webdata.html), CSS стили и скрипты JS находятся в каталоге /resources.

[История изменений](CHANGES)

### В процессе разработки:

Модуль работы с семантическими структурами - данными, представленными в виде ориентированного графа.
Создание игрового мира и разработка функций для моделирования взаимодействия объектов.

### Дальнейшие этапы проекта:

Реализация модели открытого мира - основы будущего сообщества.

## Описание

Код OneScriptDB выполняется на стороне сервера, где происходит обработка данных и формируется представление интерфейса. Результат (в виде обычного HTML) передается браузеру и загружается в определяемый идентификатором узел DOM страницы. Для работы с DOM используется библиотека JQuery. В качестве шаблона используется CoreUI и BootStrap 4.

Для запуска приложения используется скрипт starter.os. Для запуска в серверном варианте (в котором процессы пользователей завершаются при бездействии) необходимо указать ключ site и номер порта, на котором будет запущен веб-вервер. Скрипт запускает несколько процессов: веб-сервер (webserver.os), сервер данных (dataserver.os), контроллер простых статичных страниц (webdata.os). При обращении к контроллеру showdata будет запущен отдельный процесс для каждого пользовательского сеанса. Для обмена сообщениями каждый процесс открывает порт для входящих TCP-соединений. Стартер использует порт 8890. Процессы обмениваются между собой структурами данных, преобразованными в двоичные данные.

Веб-сервер (модуль webserver.os) - однопоточный (из-за ограничений движка OneScript), но позволяющий работать в многопользовательском режиме благодаря перенаправлению запросов пользователей отдельным процессам - контроллерам. По умолчанию веб-сервер использует порт 8888.

Доступ к данным осуществляется через отдельный процесс - сервер данных (dataserver.os). Сервер обрабатывает запросы асинхронно, отдавая результаты по ходу выполнения запросов. Сервер использует порт 8887. Данные сохраняются в виде заголовков и файлов внутри одного файла-контейнера(.osdb), или в отдельном текстовом файле.
В текстовых файлах данных каждая строка хранит один узел DOM. Свойства узлов хранятся в виде пары ключ - значение, разделенные символом табуляции. Код узла соответствует номеру строки в файле. Узел загружается в память в виде структуры, содержащей стандартные свойства: Код, Имя, Значение, и ссылки на другие узлы: Соседний, Дочерний, Атрибут, Старший, Родитель; а также структура временных значений Состояние. Отдельные текстовые файлы данных хранятся в папке data\.files.

Модуль контроллера одностраничного пользовательского интерфейса (showdata.os) позволяет отображать динамические страницы, сформированные на основании данных, а также изменять их структуру. Редактор структуры данных запускается в отдельном окне из главного меню программы. Для изменения структуры данных нужно выбрать нужный узел и выполнить с ним действия. Узлы можно создавать, удалять, копировать, вырезать и вставлять, изменять имя и значение. Имя узла - его тип - определяет, как он будет обрабатываться внутренним интерпретатором (в модуле pagedata.os).

Интерпретатор формирует представление данных для отображения в браузере. Каждый узел, в зависимости от его имени обрабатывается интерпретатором по разному. У (Узел) - присваивает имя подчиненной структуре данных. Узел может иметь расширения: Р (Родитель) - использование другого узла как шаблона; Ф(Функция) - вызывает функцию из подключаемой библиотеки, аргументами являются атрибуты узла: А (Аргумент). Результат выполнения функции отображается как содержимое узла и может быть интерпретирован. (Оператор) - выполняет действие над вложенными узлами. С (Ссылка) - передает ссылку на подчиненный узел либо именованный узел (У). З (Значение) - интерпретирует значение узла(У). П (Пусть) - присваивает вычисленное значение определенному узлу. В (Вставить) - копирует дочерний узел в конкретный узел (У). Указатель - передает ссылку на узел по коду узла. Свойство - получает значение свойства ссылки (структуры) , Атрибут - получает значение атрибута узла. Первый, Соседний - передает ссылку на текущий или соседний узел. Истина, Ложь, Неопределенно, Пустой, Число, Строка - передает соответствующее значение. Теги HTML передаются в виде HTML разметки.
